<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
<meta http-equiv="refresh" content="0; url=https://vmware.github.io/vic-product/index.html#getting-started" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Network Port Use Cases | Developing Container Applications with VMware vSphere Integrated Containers Engine, version 0.7.0</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="gitbook/style.css">
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="./ts_docker_version_error.html" />
    
    
    <link rel="prev" href="./using_insecure_registries_with_vic.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="7"
        data-chapter-title="Network Port Use Cases"
        data-filepath="network_use_cases.md"
        data-basepath="."
        data-revision="Mon Nov 07 2016 16:39:02 GMT+0100 (W. Europe Standard Time)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="overview_of_vic_engine.html">
            
                
                    <a href="./overview_of_vic_engine.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Overview of vSphere Integrated Containers Engine For Container Application Developers
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="container_operations.html">
            
                
                    <a href="./container_operations.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Supported Docker Commands
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="container_limitations.html">
            
                
                    <a href="./container_limitations.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Use and Limitations of Containers in vSphere Integrated Containers Engine
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="obtain_vch.html">
            
                
                    <a href="./obtain_vch.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Obtain a Virtual Container Host
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="using_volumes_with_vic.html">
            
                
                    <a href="./using_volumes_with_vic.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Using Volumes with vSphere Integrated Containers Engine
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="using_insecure_registries_with_vic.html">
            
                
                    <a href="./using_insecure_registries_with_vic.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        Using Insecure Private Registry Servers with vSphere Integrated Containers Engine
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="7" data-path="network_use_cases.html">
            
                
                    <a href="./network_use_cases.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        Network Port Use Cases
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8" data-path="ts_docker_version_error.html">
            
                
                    <a href="./ts_docker_version_error.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        Docker Commands Fail with a Docker API Version Error
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >Developing Container Applications with VMware vSphere Integrated Containers Engine, version 0.7.0</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="network-port-use-cases">Network Port Use Cases</h1>
<p>These are some use cases of containers using network ports to communicate with each other.</p>
<h3 id="container-with-a-published-port">Container with a Published Port</h3>
<p>Launch a container and expose a port: <code>run -p</code></p>
<p>Connect the container with the external mapped port on the external surface of the vSphere Container Host.</p>
<p><code>$ docker run -p 8080:80 --name test1 my_container my_app</code></p>
<h4 id="outcome">Outcome</h4>
<p>You can access Port 80 on test1 from the external network interface on the virtual container host at port 8080.</p>
<h3 id="container-on-a-simple-bridge-network">Container on a Simple Bridge Network</h3>
<p>Create a new non-default bridge network and set up two containers on the network. Verify that the containers can locate and communicate with each other.</p>
<pre><code>$ docker network create -d bridge my-bridge-network
$ docker network ls
...
NETWORK ID          NAME                DRIVER
615d565d498c        my-bridge-network   bridge
...
$ docker run -d --net=my-bridge-network \
                --name=server my_server_image server_app
$ docker run -it --name=client --net=my-bridge-network busybox
/ # ping server
PING server (172.18.0.2): 56 data bytes
64 bytes from 172.18.0.2: seq=0 ttl=64 time=0.073 ms
64 bytes from 172.18.0.2: seq=1 ttl=64 time=0.092 ms
64 bytes from 172.18.0.2: seq=2 ttl=64 time=0.088 ms
</code></pre><h4 id="outcome">Outcome</h4>
<p>Server and Client can ping each other by name.</p>
<h3 id="bridged-containers-with-exposed-port">Bridged Containers with Exposed Port</h3>
<p>Connect two containers on a bridge network and set up one of the containers to publish a port via the virtual container host. Assume server_app binds to port 5000.</p>
<pre><code>$ docker network create -d bridge my-bridge-network
$ docker network ls
...
NETWORK ID          NAME                DRIVER
615d565d498c        my-bridge-network   bridge
...
$ docker run -d -p 5000:5000 --net=my-bridge-network \
                --name=server my_server_image server_app
$ docker run -it --name=client --net=my-bridge-network busybox
/ # ping -c 3 server
PING server (172.18.0.2): 56 data bytes
64 bytes from 172.18.0.2: seq=0 ttl=64 time=0.073 ms
64 bytes from 172.18.0.2: seq=1 ttl=64 time=0.092 ms
64 bytes from 172.18.0.2: seq=2 ttl=64 time=0.088 ms
/ # telnet server 5000
GET /

Hello world!Connection closed by foreign host
$ telnet vch_external_interface 5000
Trying 192.168.218.137...
Connected to 192.168.218.137.
Escape character is &apos;^]&apos;.
GET /

Hello world!Connection closed by foreign host.
</code></pre><h4 id="outcome">Outcome</h4>
<p>Server and Client can ping each other by name. You can connect to the server on port 5000 from the client container and to port 5000 on the virtual container host external interface.</p>
<h3 id="containers-on-multiple-bridge-networks">Containers on Multiple Bridge Networks</h3>
<p>Create containers on multiple bridge networks by mapping ports through the Docker server. The virtual container host must have an IP address on the relevant bridge networks. To create bridge networks, use  <code>network create</code></p>
<p>Example:
Run a container:
 <code>docker run -it --net net1 --net net2 busybox</code>
For this container to reach both networks or containers connected to only those networks:</p>
<pre><code>docker run -it --net net1 --name n1 busybox
docker run -it --net net2 --name n2 busybox
docker run -it --net net1 --net net2 --name n12 busybox
</code></pre><h4 id="outcome">Outcome</h4>
<p>n1 and n2 cannot talk to each other<br>
n12 can talk to both n1 and n2</p>
<h3 id="containers-using-external-network">Containers using External Network</h3>
<p>Configure two external networks in vSphere:
<code>default-external</code> is <code>10.2.0.0/16</code> with gateway <code>10.2.0.1</code><br><code>vic-production</code> is <code>208.91.3.0/24</code> with gateway <code>208.91.3.1</code>  </p>
<p>Associate a virtual container host, then set up the virtual container host to the default external network at 208.91.3.2.</p>
<p><code>docker network ls</code> shows:</p>
<pre><code>$ docker network ls
NETWORK ID          NAME                DRIVER
e2113b821ead        none                null
37470ed9992f        default-external    bridge
ea96a6b919de        vic-production      bridge
b7e91524f3e2        bridge              bridge  
</code></pre><p>You have a container providing a web service to expose outside of the vSphere Integrated Containers Engine environment.</p>
<p>Output of <code>docker network inspect default-external</code>:</p>
<pre><code>[
    {
        &quot;Name&quot;: &quot;default-external&quot;,
        &quot;Id&quot;: &quot;37470ed9992f6ab922e155d8e902ca03710574d96ffbfde1b3faf541de2a701f&quot;,
        &quot;Scope&quot;: &quot;external&quot;,
        &quot;Driver&quot;: &quot;bridge&quot;,
        &quot;IPAM&quot;: {
            &quot;Driver&quot;: &quot;default&quot;,
            &quot;Options&quot;: {},
            &quot;Config&quot;: [
                {
                    &quot;Subnet&quot;: &quot;10.2.0.0/16&quot;,
                    &quot;Gateway&quot;: &quot;10.2.0.1&quot;
                }
            ]
        },
        &quot;Containers&quot;: {},
        &quot;Options&quot;: {}
    }
]
</code></pre><p>Output of <code>docker network inspect vic-production</code>:</p>
<pre><code>[
    {
        &quot;Name&quot;: &quot;vic-production&quot;,
        &quot;Id&quot;: &quot;ea96a6b919de4ca2bd627bfdf0683ca04e5a2c3360968d3c6445cb18fab6d210&quot;,
        &quot;Scope&quot;: &quot;external&quot;,
        &quot;Driver&quot;: &quot;bridge&quot;,
        &quot;IPAM&quot;: {
            &quot;Driver&quot;: &quot;default&quot;,
            &quot;Options&quot;: {},
            &quot;Config&quot;: [
                {
                    &quot;Subnet&quot;: &quot;208.91.3.0/24&quot;,
                    &quot;Gateway&quot;: &quot;208.91.3.1&quot;
                }
            ]
        },
        &quot;Containers&quot;: {},
        &quot;Options&quot;: {}
    }
]
</code></pre><p>Set up a server on the vic-production network:</p>
<pre><code>$ docker run -d --expose=80 --net=vic-production --name server my_webapp
$ docker inspect --format=&apos;{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}&apos; server
208.91.3.2
$ telnet 208.91.3.2 80
Trying 208.91.3.2...
Connected to 208.91.3.2.
Escape character is &apos;^]&apos;.
GET /

Hello world!Connection closed by foreign host.
</code></pre><p><strong>NOTE:</strong> You can also use <code>-p 80</code> or <code>-p 80:80</code> instead of
<code>--expose=80</code>. If you try to map to different ports with <code>-p</code>, you get a configuration error.</p>
<h4 id="outcome">Outcome</h4>
<p>The server container port is exposed on the external network vic-production.</p>
<h3 id="containers-using-multiple-external-networks">Containers Using Multiple External Networks</h3>
<p>Create external networks only using <code>vic-machine</code>.</p>
<p>Example:</p>
<pre><code>./vic-machine-darwin create --target 172.16.252.131 --image-store datastore1 --name vic-demo --user root --password &apos;Vmware!23&apos; --compute-resource /ha-datacenter/host/*/Resources --cn pg1:pg1 --cn pg2:pg2 --cn pg3:pg3
</code></pre><p>pg1-3 are port groups on the ESX Server that are now mapped into docker network ls.</p>
<pre><code>$ docker -H 172.16.252.150:2376 --tls network ls
NETWORK ID   NAME   DRIVER
903b61edec66 bridge bridge
95a91e11b1a8 pg1    external
ab84ba2a326b pg2    external
2df4101caac2 pg3    external
</code></pre><p>If a container is connected to an external network, the traffic to and from that network does not go through the appliance VM.</p>
<p>You also can create more bridge networks via the docker API. These are all backed by the same port group as the default bridge, but those networks are isolated via IP address management.</p>
<pre><code>Example:
$ docker -H 172.16.252.150:2376 --tls network create mikes
0848ee433797c746b466ffeb57581c301d8e96b7e82a4d524e0fa0222860ba44
$ docker -H 172.16.252.150:2376 --tls network create bob
316e34ff3b7b19501fe14982791ee139ce98e62d060203125c5dbdc8543ff641
$ docker -H 172.16.252.150:2376 --tls network ls
NETWORK ID   NAME   DRIVER
316e34ff3b7b bob    bridge
903b61edec66 bridge bridge
0848ee433797 mikes  bridge
95a91e11b1a8 pg1    external
ab84ba2a326b pg2    external
2df4101caac2 pg3    external
</code></pre><h4 id="outcome">Outcome</h4>
<p>You can create containers with --net mikes or --net pg1 and be on the correct network. With docker you can combine them and attach multiple networks.</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./using_insecure_registries_with_vic.html" class="navigation navigation-prev " aria-label="Previous page: Using Insecure Private Registry Servers with vSphere Integrated Containers Engine"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./ts_docker_version_error.html" class="navigation navigation-next " aria-label="Next page: Docker Commands Fail with a Docker API Version Error"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

    
    <script src="gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
