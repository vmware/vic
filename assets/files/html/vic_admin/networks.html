<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>vSphere Integrated Containers Network Overview | VMWare vSphere Integrated Containers for vSphere Administrators</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="gitbook/style.css">
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="./remove_vch.html" />
    
    
    <link rel="prev" href="./interop.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="3"
        data-chapter-title="vSphere Integrated Containers Network Overview"
        data-filepath="networks.md"
        data-basepath="."
        data-revision="Thu Jun 09 2016 15:26:47 GMT+0200 (W. Europe Daylight Time)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="vicarch.html">
            
                
                    <a href="./vicarch.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        vSphere Integrated Containers Architecture
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="interop.html">
            
                
                    <a href="./interop.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        vSphere Integrated Containers Interoperability with Other VMware Software
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="3" data-path="networks.html">
            
                
                    <a href="./networks.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        vSphere Integrated Containers Network Overview
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="remove_vch.html">
            
                
                    <a href="./remove_vch.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Remove a Virtual Container Host
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >VMWare vSphere Integrated Containers for vSphere Administrators</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="vsphere-integrated-containers-network-overview">vSphere Integrated Containers Network Overview</h1>
<p>vSphere Container Host connects to four network types:</p>
<ul>
<li>vSphere Management Network: to communicate with vCenter and ESXi hosts. This network also serves as a tether within the containers to communicate with the vSphere Container Host.</li>
<li>Docket Management Endpoint Network: to connect to Docker clients and isolate the Docker endpoints from the more public external network.</li>
<li>External Network: to connect to the internet. Containers can use this external network to publish network services. After defining the external network, you can deploy containers directly on the external interface.</li>
<li>Container Network: to allow containers to communicate with each other.</li>
</ul>
<p><img src="network_diagram.png" alt="vSphere Integrated Containers Networks"></p>
<h2 id="the-port-layer">The Port Layer</h2>
<p>You can configure networks that are tied into the vSphere infrastructure. Pre-configured networks available to a vSphere Container Host are determined by the networks that are part of the provisioning or added when you reconfigure the vSphere Container Host.</p>
<p>The port layer augments vSphere API with low level, platform-specific primitives to allow you to implement a simple container engine:</p>
<ul>
<li>Port Layer Execution: Handles container management, such as create, start, and stop. </li>
<li>Port Layer Interaction: Handles interaction with a running container. </li>
<li>Port Layer Networking: Handles specific vSphere NSX network mappings into the Docker network namespace as well as mapping existing network entities such as database servers into the Docker container namespace with defined aliases.</li>
<li>Port Layer Storage: Provides storage manipulation, including container image storage, layering with volume creation and manipulation. imagec, the docker registry client library, uses this component to translate registry images into a layered format that VMDK disk chains can use directly.</li>
</ul>
<h2 id="tether-process">Tether Process</h2>
<p>The tether process is a minimal agent in the container VM that starts and stops processes and provides monitoring statistics. </p>
<h2 id="use-cases">Use Cases</h2>
<p>These are some use cases of containers using network ports to communicate with each other.</p>
<h4 id="container-with-a-published-port">Container with a Published Port</h4>
<p>Launch a container and expose a port: <code>run -p</code></p>
<p>Connect the container with the external mapped port on the external surface of the vSphere Container Host.</p>
<p><code>$ docker run -p 8080:80 --name test1 my_container my_app</code></p>
<h5 id="outcome">Outcome</h5>
<p>You can access Port 80 on test1 from the external network interface on the vSphere Container Host at port 8080.</p>
<h4 id="simple-bridge-network">Simple Bridge Network</h4>
<p>Create a new non-default bridge network and set up two containers on the network. Verify that the containers can locate and communicate with each other.</p>
<pre><code>$ docker network create -d bridge my-bridge-network
$ docker network ls
...
NETWORK ID          NAME                DRIVER
615d565d498c        my-bridge-network   bridge
...
$ docker run -d --net=my-bridge-network \
                --name=server my_server_image server_app
$ docker run -it --name=client --net=my-bridge-network busybox
/ # ping server
PING server (172.18.0.2): 56 data bytes
64 bytes from 172.18.0.2: seq=0 ttl=64 time=0.073 ms
64 bytes from 172.18.0.2: seq=1 ttl=64 time=0.092 ms
64 bytes from 172.18.0.2: seq=2 ttl=64 time=0.088 ms
</code></pre><h5 id="outcome">Outcome</h5>
<p>Server and Client can ping each other by name.</p>
<h4 id="bridged-containers-with-exposed-port">Bridged Containers with Exposed Port</h4>
<p>Connect two containers on a bridge network and set up one of the containers to publish a port via the vSphere Container Host. Assume server_app binds to port 5000.</p>
<pre><code>$ docker network create -d bridge my-bridge-network
$ docker network ls
...
NETWORK ID          NAME                DRIVER
615d565d498c        my-bridge-network   bridge
...
$ docker run -d -p 5000:5000 --net=my-bridge-network \
                --name=server my_server_image server_app
$ docker run -it --name=client --net=my-bridge-network busybox
/ # ping -c 3 server
PING server (172.18.0.2): 56 data bytes
64 bytes from 172.18.0.2: seq=0 ttl=64 time=0.073 ms
64 bytes from 172.18.0.2: seq=1 ttl=64 time=0.092 ms
64 bytes from 172.18.0.2: seq=2 ttl=64 time=0.088 ms
/ # telnet server 5000
GET /

Hello world!Connection closed by foreign host
$ telnet vch_external_interface 5000
Trying 192.168.218.137...
Connected to 192.168.218.137.
Escape character is &apos;^]&apos;.
GET /

Hello world!Connection closed by foreign host.
</code></pre><h5 id="outcome">Outcome</h5>
<p>Server and Client can ping each other by name. You can connect to the server on port 5000 from the client container and to port 5000 on the vSphere Container Host external interface.</p>
<h4 id="containers-using-external-network">Containers using External Network</h4>
<p>Configure two external networks in vSphere:
<code>default-external</code> is <code>10.2.0.0/16</code> with gateway <code>10.2.0.1</code><br><code>vic-production</code> is <code>208.91.3.0/24</code> with gateway <code>208.91.3.1</code>  </p>
<p>Associate a vSphere Container Host, then set up the vSphere Container Host to the default external network.</p>
<p>Attach the vSphere Container Host to the default-external network at 08.91.3.2.</p>
<p><code>docker network ls</code> shows:</p>
<pre><code>$ docker network ls
NETWORK ID          NAME                DRIVER
e2113b821ead        none                null
37470ed9992f        default-external    bridge
ea96a6b919de        vic-production      bridge
b7e91524f3e2        bridge              bridge  
</code></pre><p>You have a container providing a web service to expose outside of the vSphere Integrated Containers environment.</p>
<p>Output of <code>docker network inspect default-external</code>:</p>
<pre><code>[
    {
        &quot;Name&quot;: &quot;default-external&quot;,
        &quot;Id&quot;: &quot;37470ed9992f6ab922e155d8e902ca03710574d96ffbfde1b3faf541de2a701f&quot;,
        &quot;Scope&quot;: &quot;external&quot;,
        &quot;Driver&quot;: &quot;bridge&quot;,
        &quot;IPAM&quot;: {
            &quot;Driver&quot;: &quot;default&quot;,
            &quot;Options&quot;: {},
            &quot;Config&quot;: [
                {
                    &quot;Subnet&quot;: &quot;10.2.0.0/16&quot;,
                    &quot;Gateway&quot;: &quot;10.2.0.1&quot;
                }
            ]
        },
        &quot;Containers&quot;: {},
        &quot;Options&quot;: {}
    }
]
</code></pre><p>Output of <code>docker network inspect vic-production</code>:</p>
<pre><code>[
    {
        &quot;Name&quot;: &quot;vic-production&quot;,
        &quot;Id&quot;: &quot;ea96a6b919de4ca2bd627bfdf0683ca04e5a2c3360968d3c6445cb18fab6d210&quot;,
        &quot;Scope&quot;: &quot;external&quot;,
        &quot;Driver&quot;: &quot;bridge&quot;,
        &quot;IPAM&quot;: {
            &quot;Driver&quot;: &quot;default&quot;,
            &quot;Options&quot;: {},
            &quot;Config&quot;: [
                {
                    &quot;Subnet&quot;: &quot;208.91.3.0/24&quot;,
                    &quot;Gateway&quot;: &quot;208.91.3.1&quot;
                }
            ]
        },
        &quot;Containers&quot;: {},
        &quot;Options&quot;: {}
    }
]
</code></pre><p>Set up a server on the vic-production network:</p>
<pre><code>$ docker run -d --expose=80 --net=vic-production --name server my_webapp
$ docker inspect --format=&apos;{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}&apos; server
208.91.3.2
$ telnet 208.91.3.2 80
Trying 208.91.3.2...
Connected to 208.91.3.2.
Escape character is &apos;^]&apos;.
GET /

Hello world!Connection closed by foreign host.
</code></pre><p><strong>NOTE:</strong> You can also use <code>-p 80</code> or <code>-p 80:80</code> instead of
<code>--expose=80</code>. If you try to map to different ports with <code>-p</code>, you get a configuration error.</p>
<h5 id="outcome">Outcome</h5>
<p>The server container port is exposed on the external network vic-production.</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./interop.html" class="navigation navigation-prev " aria-label="Previous page: vSphere Integrated Containers Interoperability with Other VMware Software"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./remove_vch.html" class="navigation navigation-next " aria-label="Next page: Remove a Virtual Container Host"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

    
    <script src="gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
